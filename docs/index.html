<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fusion Server: Fusion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fusion Server
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   <div id="projectbrief">This is the server for the Fusion game.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Fusion </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the source code of the server for the <b>Fusion</b> game.</p>
<h2>Third-party libraries</h2>
<ul>
<li><a href="https://github.com/gabime/spdlog">spdlog</a> - Very fast, header-only/compiled, C++ logging library.</li>
<li><a href="https://github.com/nlohmann/json">nlohmann/json</a> - JSON for Modern C++.</li>
<li><a href="https://github.com/google/googletest">Google Test</a> - Google's C++ test framework.</li>
<li><a href="https://www.boost.org/">Boost</a> - free peer-reviewed portable C++ source libraries (requires <a href="https://www.boost.org/users/history/version_1_67_0.html">Boost 1.67</a> installed on the system).</li>
</ul>
<h2>Protocol</h2>
<p>This section describes the protocol used in the connunication between the server and its clients.</p>
<h3>Common part</h3>
<p>Each package CAN have the <code>id</code> field. This is a random number to identify this package in the session. The other side of the connection can send a packge with the same <code>id</code> to indicate, that it's a response to the previous one.</p>
<h3>Client -&gt; Server</h3>
<p>This section describes packages send by a client.</p>
<h4>JOIN package</h4>
<p>This package is a join request to the server. A Client can be only in one game at a time. If this packge was sent and the client has already joined to a game, the server will close the connection imediately.</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;id&quot;: 0,</div><div class="line">  &quot;type&quot;: &quot;join&quot;,</div><div class="line">  &quot;game&quot;: &quot;&lt;the game&#39;s name&gt;&quot;,</div><div class="line">  &quot;nick&quot;: &quot;&lt;player&#39;s nick&gt;&quot;</div><div class="line">}</div></div><!-- fragment --><h5>Server's Response</h5>
<p>The <code>result</code> field can have to values. <code>joined</code> means that, the player has joined to the game. <code>full</code> value means that the requested game is full and joining to it is not possible. The <code>players</code> field is an array of objects. Each object describes one player. The <code>rays</code> field is an array of light rays presnt in the game at the current moment. It can be empty if there are no rays.</p>
<ul>
<li>The client HAS TO save the values of <code>player_id</code> fields, all further updates about players will contain <code>player_id</code> field to identify them.</li>
<li>The client HAS TO save the values of <code>ray_id</code> fields, all further updates about rays will contain <code>ray_id</code> field to identify them.</li>
<li>The <code>my_id</code> field's value is the id of this client.</li>
</ul>
<p><b>Note</b>: The <code>players</code> and <code>rays</code> arrays have meaning only if the joining was successful, otherwise there won't be included and therefore should not be looked for.</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;id&quot;: 0,</div><div class="line">  &quot;result&quot;: &quot;joined|full&quot;,</div><div class="line">  &quot;my_id&quot;: 1337,</div><div class="line">  &quot;players&quot;: [</div><div class="line">    {</div><div class="line">      &quot;player_id&quot;: 0,</div><div class="line">      &quot;team_id&quot;: 0,</div><div class="line">      &quot;nick&quot;: &quot;&lt;player&#39;s nick&gt;&quot;,</div><div class="line">      &quot;role&quot;: &quot;&lt;player&#39;s role&gt;&quot;,</div><div class="line">      &quot;color&quot;: [255, 255, 255],</div><div class="line">      &quot;health&quot;: 100.0,</div><div class="line">      &quot;position&quot;: [7.6, 87.2],</div><div class="line">      &quot;angle&quot;: 67.2 // &lt;0.0; 360.0)</div><div class="line">    },</div><div class="line">    // ...</div><div class="line">  ],</div><div class="line">  &quot;rays&quot;: [</div><div class="line">    {</div><div class="line">      &quot;ray_id&quot;: 0,</div><div class="line">      &quot;source&quot;: [7.6, 87.2],</div><div class="line">      &quot;destination&quot;: [17.6, 187.2],</div><div class="line">      &quot;color&quot;: [255, 255, 255]</div><div class="line">    },</div><div class="line">    // ...</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><h4>UPDATE package</h4>
<p>This package is used to update the position of the player. It should be sent each time when the player either moved, rotated or fired.</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;type&quot;: &quot;update&quot;,</div><div class="line">  &quot;team_id&quot;: 0,</div><div class="line">  &quot;position&quot;: [7.6, 87.2],</div><div class="line">  &quot;angle&quot;: 67.2 // &lt;0.0; 360.0)</div><div class="line">}</div></div><!-- fragment --><h5>Server's Response</h5>
<p>There is no "response" from the server, however the client should not perform any updates on its own sprite, until it receives an UPDATE package from the server, which will be broadcasted to all players.</p>
<h4>LEAVE package</h4>
<p>This package is used to leave the current game. This request to the server is always successful, therefore the server won't repond to it. The <code>leave</code> field can have any value.</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;type&quot;: &quot;leave&quot;</div><div class="line">}</div></div><!-- fragment --><h5>Server's Response</h5>
<p><b>Note</b>: There is no server's response for this request.</p>
<h3>Server -&gt; Client</h3>
<p>This section describes the packages send by the server.</p>
<h3>UPDATE package</h3>
<p>The <code>players</code> array contains players objects present in the game, that have updated their attributes. If no player has updated its attributes, the array will be empty, but will not be omitted. If a player either has joined or left, the player object will contain additional fields, described below. The values of <code>joined</code> and <code>left</code> fields have no meaning and should not be checked.</p>
<p>The <code>rays</code> array contains rays objects of the game. The values of <code>new</code> and <code>remove</code> fields have no meaning and should not be checked. If a ray object has neither <code>new</code> nor <code>remove</code> field it means that, an existing ray has been changed. If the game doesn't have any rays or the existing rays didn't change, the array will be empty, but will not be omitted.</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;type&quot;: &quot;update&quot;,</div><div class="line">  &quot;players&quot;: [</div><div class="line">    {</div><div class="line">      &quot;player_id&quot;: 1,</div><div class="line">      &quot;position&quot;: [0.0, 0.0],</div><div class="line">      &quot;angle&quot;: 67.8, // &lt;0.0; 360.0)</div><div class="line">      &quot;health&quot;: 100.0,</div><div class="line">      &quot;joined&quot;: true, // only when joined</div><div class="line">      &quot;nick&quot;: &quot;&lt;new_nick&gt;&quot;, // only when joined</div><div class="line">      &quot;role&quot;: &quot;&lt;new_role&gt;&quot;, // only when joined</div><div class="line">      &quot;color&quot;: [255, 255, 255], // // only when joined</div><div class="line">      &quot;left&quot;: true // only when left</div><div class="line">    },</div><div class="line">    // ...</div><div class="line">  ],</div><div class="line">  &quot;rays&quot;: [</div><div class="line">    {</div><div class="line">      &quot;ray_id&quot;: 1,</div><div class="line">      &quot;source&quot;: [0.0, 0.0],</div><div class="line">      &quot;destination&quot;: [0.0, 0.0],</div><div class="line">      &quot;new&quot;: true, // only when a ray is a new one</div><div class="line">      &quot;remove&quot;: true // only when a ray should be removed</div><div class="line">    },</div><div class="line">    // ...</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><h2>License</h2>
<p>The MIT License. See <code>LICENSE.txt</code> file. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
